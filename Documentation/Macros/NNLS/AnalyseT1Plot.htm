<html>

<head>
<meta http-equiv=Content-Type content="text/html; charset=windows-1252">
<meta name=Generator content="Microsoft Word 14 (filtered)">
<title>The NNLS analysis</title>
<style>
<!--
 /* Font Definitions */
 @font-face
	{font-family:Wingdings;
	panose-1:5 0 0 0 0 0 0 0 0 0;}
@font-face
	{font-family:Wingdings;
	panose-1:5 0 0 0 0 0 0 0 0 0;}
@font-face
	{font-family:Cambria;
	panose-1:2 4 5 3 5 4 6 3 2 4;}
@font-face
	{font-family:Tahoma;
	panose-1:2 11 6 4 3 5 4 4 2 4;}
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
	{margin:0cm;
	margin-bottom:.0001pt;
	font-size:12.0pt;
	font-family:"Times New Roman","serif";}
h1
	{mso-style-link:"Heading 1 Char";
	margin-top:24.0pt;
	margin-right:0cm;
	margin-bottom:0cm;
	margin-left:0cm;
	margin-bottom:.0001pt;
	page-break-after:avoid;
	font-size:14.0pt;
	font-family:"Cambria","serif";
	color:#365F91;}
h2
	{mso-style-link:"Heading 2 Char";
	margin-top:12.0pt;
	margin-right:0cm;
	margin-bottom:3.0pt;
	margin-left:0cm;
	page-break-after:avoid;
	font-size:14.0pt;
	font-family:"Arial","sans-serif";
	font-style:italic;}
h3
	{mso-style-link:"Heading 3 Char";
	margin-top:12.0pt;
	margin-right:0cm;
	margin-bottom:3.0pt;
	margin-left:0cm;
	page-break-after:avoid;
	font-size:13.0pt;
	font-family:"Arial","sans-serif";}
p.MsoFooter, li.MsoFooter, div.MsoFooter
	{mso-style-link:"Footer Char";
	margin:0cm;
	margin-bottom:.0001pt;
	font-size:12.0pt;
	font-family:"Times New Roman","serif";}
p.MsoAcetate, li.MsoAcetate, div.MsoAcetate
	{mso-style-link:"Balloon Text Char";
	margin:0cm;
	margin-bottom:.0001pt;
	font-size:8.0pt;
	font-family:"Tahoma","sans-serif";}
span.Heading1Char
	{mso-style-name:"Heading 1 Char";
	mso-style-link:"Heading 1";
	font-family:"Cambria","serif";
	color:#365F91;
	font-weight:bold;}
span.Heading2Char
	{mso-style-name:"Heading 2 Char";
	mso-style-link:"Heading 2";
	font-family:"Cambria","serif";
	color:windowtext;
	font-weight:bold;}
span.Heading3Char
	{mso-style-name:"Heading 3 Char";
	mso-style-link:"Heading 3";
	font-family:"Cambria","serif";
	color:windowtext;
	font-weight:bold;}
span.FooterChar
	{mso-style-name:"Footer Char";
	mso-style-link:Footer;}
span.BalloonTextChar
	{mso-style-name:"Balloon Text Char";
	mso-style-link:"Balloon Text";
	font-family:"Tahoma","sans-serif";}
 /* Page Definitions */
 @page WordSection1
	{size:595.3pt 841.9pt;
	margin:72.0pt 89.85pt 72.0pt 89.85pt;}
div.WordSection1
	{page:WordSection1;}
 /* List Definitions */
 ol
	{margin-bottom:0cm;}
ul
	{margin-bottom:0cm;}
-->
</style>

</head>

<body lang=EN-NZ>

<div class=WordSection1>

<h1 style='margin-top:0cm;background:#FF6600'><a name="_Toc279751947"><span
style='font-size:20.0pt;color:black'>NNLS – AnalyseT1Plot</span></a></h1>

<p class=MsoNormal><span style='color:black'>&nbsp;</span></p>

<p class=MsoNormal><span style='color:black'>&nbsp;</span></p>

<p class=MsoNormal><span style='color:black'>This macro provides an interface
for inverting one dimensional T1 relaxation data sets using non-negative least
squares analysis. Data set should have been collected using the
T1-IR-Add/T1-IR-Echo/T1-IR-Fid (Kea) or T1IRFid/T1IRCPMG (RCA) macros. </span></p>

<p class=MsoNormal><span style='color:black'>&nbsp;</span></p>

<h3><span lang=EN-GB>Relaxation spectra</span></h3>

<p class=MsoNormal><span style='color:black'>&nbsp;</span></p>

<p class=MsoNormal style='text-align:justify'><span style='color:black'>When a
single relaxation time constant is present it is sufficient to use simple
non-linear (or linearized) fits. However when there is a range or spectrum of
relaxation times a different approach must be taken. The non-negative least
square inverse Laplace algorithms provide this functionality.</span></p>

<p class=MsoNormal><span style='color:black'>&nbsp;</span></p>

<h3><span lang=EN-GB>Non negative least square analysis</span></h3>

<p class=MsoNormal><span lang=EN-GB>&nbsp;</span></p>

<p class=MsoNormal style='text-align:justify'><span lang=EN-GB>Unlike the
Fourier transform which converts uniquely between time and frequency domain
data, the inverse Laplace problem, which moves between time domain and relaxation
time constant space, is ill-defined, meaning there are a number of solutions
all of which fit the original data equally well. The best fit is usually a
series of short, well-defined spectral peaks. However this often does not make
sense from a physical point of view – a continuous range of relaxation times is
more likely. For this reason we should choose a solution which gives spectral
lines which are as broad as possible, consistent with a good fit and the noise
level in the original data. i.e. noisy data should produce broader lines than a
data set with high SNR, reflecting the increased uncertainty.</span></p>

<p class=MsoNormal style='text-align:justify'><span lang=EN-GB>&nbsp;</span></p>

<p class=MsoNormal style='text-align:justify'><span lang=EN-GB>T1 data may be
collected using several different techniques. The most common is the inversion
recovery method with produces a curve of the form: <span style='position:relative;
top:6.0pt'><img width=155 height=24 src="AnalyseT1Plot_files/image001.png"></span></span>.
<span lang=EN-GB>In this document we will use the demonstration result
“saturated” to illustrate the operation of the T1 analysis window. </span></p>

<p class=MsoNormal style='text-align:justify'><span lang=EN-GB>&nbsp;</span></p>

<p class=MsoNormal style='text-align:justify'><span lang=EN-GB>The raw T1 decay
curve looks like this:</span></p>

<p class=MsoNormal style='text-align:justify'><span lang=EN-GB>&nbsp;</span></p>

<p class=MsoNormal align=center style='text-align:center'><img width=551
height=241 src="AnalyseT1Plot_files/image002.jpg"></p>

<p class=MsoNormal style='text-align:justify'><span lang=EN-GB>This data set
has 50 points logarithmically spaced from 1 to 1000 ms. Here is the same plot
with the x-axis in log-mode:</span></p>

<p class=MsoNormal style='text-align:justify'><span lang=EN-GB>&nbsp;</span></p>

<p class=MsoNormal align=center style='text-align:center'><img width=551
height=241 src="AnalyseT1Plot_files/image003.jpg"></p>

<p class=MsoNormal style='text-align:justify'><span lang=EN-GB>&nbsp;</span></p>

<h3><span lang=EN-GB>The Lawson and Hanson NNLS analysis</span></h3>

<p class=MsoNormal><span lang=EN-GB>&nbsp;</span></p>

<p class=MsoNormal style='text-align:justify'><span lang=EN-GB>Start by
selecting the data to be analysed by clicking on it with the mouse (it is
assumed that it has been loaded into a 1D plot window). Then start the
AnalyseT1Plot macro which is found in the NNLS menu. The following window will
appear.</span></p>

<p class=MsoNormal><span lang=EN-GB>&nbsp;</span></p>

<p class=MsoNormal align=center style='text-align:center'><img width=568
height=369 id="Picture 1" src="AnalyseT1Plot_files/image004.jpg"></p>

<p class=MsoNormal><span lang=EN-GB>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-GB>Next choose the analysis method. We will
start with the Lawson and Hanson (L&amp;H) option. Also select the appropriate
fit function:</span></p>

<p class=MsoNormal><span lang=EN-GB>&nbsp;</span></p>

<p class=MsoNormal align=center style='text-align:center'><span lang=EN-GB><img
width=256 height=115 src="AnalyseT1Plot_files/image005.png"></span></p>

<p class=MsoNormal><span lang=EN-GB>&nbsp;</span></p>

<p class=MsoNormal style='text-align:justify'><span lang=EN-GB>Next set the
minimum and maximum relaxation time values to the data set limits. One hundred
relaxation steps are usually sufficient. Choose a smoothing parameter of 1.</span></p>

<p class=MsoNormal><span lang=EN-GB>&nbsp;</span></p>

<p class=MsoNormal align=center style='text-align:center'><span lang=EN-GB><img
width=202 height=116 src="AnalyseT1Plot_files/image006.png">          <img
width=154 height=122 src="AnalyseT1Plot_files/image007.png"></span></p>

<p class=MsoNormal><span lang=EN-GB>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-GB>Press the Calculate spectrum button</span></p>

<p class=MsoNormal><span lang=EN-GB>&nbsp;</span></p>

<p class=MsoNormal align=center style='text-align:center'><span lang=EN-GB><img
width=149 height=123 src="AnalyseT1Plot_files/image008.png"></span></p>

<p class=MsoNormal><span lang=EN-GB>&nbsp;</span></p>

<p class=MsoNormal style='text-align:justify'><span lang=EN-GB>This generates a
number of different graphs:</span></p>

<p class=MsoNormal style='text-align:justify'><span lang=EN-GB>&nbsp;</span></p>

<p class=MsoNormal align=center style='text-align:center'><span lang=EN-GB><img
width=550 height=366 src="AnalyseT1Plot_files/image009.jpg"></span></p>

<p class=MsoNormal style='text-align:justify'><span lang=EN-GB>&nbsp;</span></p>

<p class=MsoNormal style='text-align:justify'><span lang=EN-GB>Top left is the
relaxation spectrum, top right the cumulative sum of this spectrum, bottom left
the residuals of the multi-exponential fit with the original data set, and
bottom left the statistics of these residuals along with the noise statistics
of the imaginary part of the original data set.</span></p>

<p class=MsoNormal><span lang=EN-GB>&nbsp;</span></p>

<p class=MsoNormal style='text-align:justify'><span lang=EN-GB>The smoothing
parameter can be chosen by starting with a large value (larger means a smoother
curve) – say 100 and then decreasing by factors of 10 until the chi-squared
matches the ideal value (shown in the lower left corner of the window). In reality
this may not be possible and the chi-squared may reach a plateau which is
larger or smaller than the ideal – this depends on the noise statistics. In
this case you can run the &quot;Calculate smoothing curve&quot; to determine
the optimal value:</span></p>

<p class=MsoNormal><span lang=EN-GB>&nbsp;</span></p>

<p class=MsoNormal align=center style='text-align:center'><span lang=EN-GB><img
width=234 height=118 src="AnalyseT1Plot_files/image010.png"></span></p>

<p class=MsoNormal><span lang=EN-GB>&nbsp;</span></p>

<p class=MsoNormal align=center style='text-align:center'><span lang=EN-GB><img
width=553 height=231 src="AnalyseT1Plot_files/image011.jpg"></span></p>

<p class=MsoNormal><span lang=EN-GB>&nbsp;</span></p>

<p class=MsoNormal style='text-align:justify'><span lang=EN-GB>In this </span>case
the standard deviation of the residuals starts to rise at a smoothing parameter
of about 3.5. The knee point is defined as the smoothing value at which the
slope of the log-log chi-squared plot is 0.1 and is often a good choice for the
smoothing factor. Above this the standard deviation is greater that the plateau
region. The effect of extreme<span style='font-family:Symbol'> </span>smoothing
values is shown below:</p>

<p class=MsoNormal>&nbsp;</p>

<p class=MsoNormal align=center style='text-align:center'><img width=553
height=231 src="AnalyseT1Plot_files/image012.jpg"></p>

<p class=MsoNormal align=center style='text-align:center'><i>smoothing =35,
SD=0.12</i></p>

<p class=MsoNormal align=center style='text-align:center'>&nbsp;</p>

<p class=MsoNormal><span lang=EN-GB>&nbsp;</span></p>

<p class=MsoNormal align=center style='text-align:center'><img width=553
height=231 src="AnalyseT1Plot_files/image013.jpg"></p>

<p class=MsoNormal align=center style='text-align:center'><i><span lang=EN-GB>smoothing
= 3.5</span>, SD=0.021</i></p>

<p class=MsoNormal align=center style='text-align:center'><span lang=EN-GB>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-GB>&nbsp;</span></p>

<p class=MsoNormal align=center style='text-align:center'><img width=553
height=231 src="AnalyseT1Plot_files/image014.jpg"></p>

<p class=MsoNormal align=center style='text-align:center'><i>smoothing = 0.35,
SD = 0.021</i></p>

<p class=MsoNormal align=center style='text-align:center'><span lang=EN-GB>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-GB>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-GB>Small smoothing factors give too many
features while the reverse is too smooth and the fit is poor.</span></p>

<p class=MsoNormal><span lang=EN-GB>&nbsp;</span></p>

<p class=MsoNormal style='text-align:justify'><span lang=EN-GB>In addition to
the smoothing curve and the standard deviation of the residuals, you should
also look at the residuals and statistics. In the residuals plot there should
not be any significant oscillations  - i.e. the result should just look like
noise:</span></p>

<p class=MsoNormal><span lang=EN-GB>&nbsp;</span></p>

<p class=MsoNormal align=center style='text-align:center'><img width=553
height=231 src="AnalyseT1Plot_files/image015.jpg"></p>

<p class=MsoNormal><span lang=EN-GB>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-GB>The statistics curves should look
approximately Gaussian in shape (this will not be obvious unless you have
collected a large number of points).</span></p>

<p class=MsoNormal><span lang=EN-GB>&nbsp;</span></p>

<div align=center>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='margin-left:-5.3pt;border-collapse:collapse'>
 <tr>
  <td width=284 valign=top style='width:213.2pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><img width=271 height=201
  src="AnalyseT1Plot_files/image016.jpg"></p>
  <p class=MsoNormal align=center style='text-align:center'><i>50 points
  collected</i></p>
  </td>
  <td width=284 valign=top style='width:213.2pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-GB><img width=279 height=201
  src="AnalyseT1Plot_files/image017.jpg"></span></p>
  <p class=MsoNormal align=center style='text-align:center'><i><span
  lang=EN-GB>200 points collected</span></i></p>
  </td>
 </tr>
</table>

</div>

<p class=MsoNormal><span lang=EN-GB>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-GB>Oscillations in the residuals curve or
misplaced statistics curves are often produced if the smoothing value is too
high:</span></p>

<p class=MsoNormal><span lang=EN-GB>&nbsp;</span></p>

<p class=MsoNormal align=center style='text-align:center'><img width=545
height=224 src="AnalyseT1Plot_files/image018.jpg"></p>

<p class=MsoNormal align=center style='text-align:center'><i><span lang=EN-GB>Setting
the smoothing value to 35 results in oscillations.</span></i></p>

<p class=MsoNormal><span lang=EN-GB>&nbsp;</span></p>

<p class=MsoNormal style='text-align:justify'><span lang=EN-GB>There is a
temptation with relaxations measurements to try and determine spectral values
outside the measured range. This should be avoided as it will often give
spurious peaks which have no physical significance. </span></p>

<p class=MsoNormal><span lang=EN-GB>&nbsp;</span></p>

<p class=MsoNormal><b>Log Binning</b></p>

<p class=MsoNormal><span lang=EN-GB>&nbsp;</span></p>

<p class=MsoNormal style='text-align:justify'><span lang=EN-GB>There are
addition controls in the Analysis method section of the interface which allows
log binning of data to be switched off and on and to control whether each bin
is correctly weighted by the number of points in it. Normally ‘Weight bins’
should not be selected. You should only use log binning if the data has been
collected using a linear delay spacing and you have more than ~50 points.</span></p>

<p class=MsoNormal><span lang=EN-GB>&nbsp;</span></p>

<p class=MsoNormal align=center style='text-align:center'><span lang=EN-GB><img
width=122 height=117 src="AnalyseT1Plot_files/image019.png">      <img
width=152 height=116 src="AnalyseT1Plot_files/image020.png"></span></p>

<p class=MsoNormal><span lang=EN-GB>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-GB>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-GB>When log binning is selected you can also
choose the number of bins in the analysis parameter section.  </span></p>

<h3><a name="_Toc279751948"><span lang=EN-GB>The Lexus Analysis</span></a></h3>

<p class=MsoNormal><b><i><span lang=EN-GB>&nbsp;</span></i></b></p>

<p class=MsoNormal style='text-align:justify'><span lang=EN-GB>An alternative
method is called &quot;Lexus&quot; and is an enhanced version of the
Butler-Reed-Dawson algorithm. This technique also has the advantage of
providing logarithmic binning on data points. As a consequence of this only 50
to 200 “points to analyse” are required. The Lexus algorithm will often produce
better results for very short relaxation times than the L&amp;H method so it is
worth trying both.</span></p>

<p class=MsoNormal><span lang=EN-GB>&nbsp;</span></p>

<p class=MsoNormal align=center style='text-align:center'><span lang=EN-GB><img
width=550 height=394 src="AnalyseT1Plot_files/image021.jpg"></span></p>

<p class=MsoNormal><span lang=EN-GB>&nbsp;</span></p>

<p class=MsoNormal style='text-align:justify'><span lang=EN-GB>There are two
methods for calculating the spectrum. The first called &quot;Weight&quot; uses
a parameter of the same name to determine the spectral smoothing. Larger Weight
values result in broader peaks. In this sense if works like the smoothing
parameter in the Lawson and Hanson method. The second method &quot;SNR&quot;
automatically adjusts the Weight parameter until the standard deviation of the
residuals is close to the original data. The closeness is defined by the
parameter RSig. 1.02 is the recommended value. This technique is similar to
using the smoothing curve in the L&amp;H method but generally a lot quicker and
can often result in fewer artefacts. If you obtain the message</span></p>

<p class=MsoNormal style='text-align:justify'><span lang=EN-GB>&nbsp;</span></p>

<p class=MsoNormal align=center style='text-align:center'><img width=269
height=159 id="Picture 5" src="AnalyseT1Plot_files/image022.png"></p>

<p class=MsoNormal style='text-align:justify'><span lang=EN-GB>&nbsp;</span></p>

<p class=MsoNormal style='text-align:justify'><span lang=EN-GB>then try
adjusting the parameters until a valid solution is produced (sometimes a change
of the algorithm URF/Asymp will help).</span></p>

<p class=MsoNormal style='text-align:justify'><span lang=EN-GB>&nbsp;</span></p>

<p class=MsoNormal style='text-align:justify'><span lang=EN-GB>Typically the
L&amp;H and Lexus methods give similar results if the parameters are carefully
chosen:</span></p>

<p class=MsoNormal style='text-align:justify'><span lang=EN-GB>&nbsp;</span></p>

<p class=MsoNormal align=center style='text-align:center'><img width=551
height=241 src="AnalyseT1Plot_files/image023.jpg"></p>

<p class=MsoNormal style='text-align:justify'>&nbsp;</p>

<p class=MsoNormal style='text-align:justify'><b>&nbsp;</b></p>

<p class=MsoNormal style='text-align:justify'><b>Other fit functions</b></p>

<p class=MsoNormal style='text-align:justify'>&nbsp;</p>

<p class=MsoNormal style='text-align:justify'>In addition to the <span
lang=EN-GB><span style='position:relative;top:6.0pt'><img width=155 height=24
src="AnalyseT1Plot_files/image001.png"></span> fit function the AnalyseT1Plot
macro also supports data sets which have been modified to follow simple
exponential decays: <span style='position:relative;top:6.0pt'><img width=123
height=24 src="AnalyseT1Plot_files/image024.png"></span> or a completely
positive recovery curve: <span style='position:relative;top:6.0pt'><img
width=148 height=24 src="AnalyseT1Plot_files/image025.png"></span>. The first
option is the method used in the T1T2 experiment. Data is collected using the
inversion recovery method but is subtracted from a long delay result which
should approximate <i>S</i><sub>0</sub> reasonably well i.e.</span></p>

<p class=MsoNormal style='text-align:justify'><span lang=EN-GB>&nbsp;</span></p>

<p class=MsoNormal align=center style='text-align:center'><span lang=EN-GB><span
style='position:relative;top:6.0pt'><img width=307 height=24
src="AnalyseT1Plot_files/image026.png"></span></span></p>

<p class=MsoNormal style='text-align:justify'><span lang=EN-GB>&nbsp;</span></p>

<p class=MsoNormal style='text-align:justify'><span lang=EN-GB>The advantage of
this method is that it is not so sensitive to errors caused by non-ideal 180
pulses which can distort the amplitude of the short delay signals. This latter
distortion will often produce anomalous short time peaks in the relaxation
spectrum of the normal inversion recovery analysis. This method is also used in
the RCA T1IRCPMG and the Kea T1-IR-ADD experiments.</span></p>

<p class=MsoNormal style='text-align:justify'><span lang=EN-GB>&nbsp;</span></p>

<h3><a name="_Toc366572924">Peak integration</a></h3>

<p class=MsoNormal>&nbsp;</p>

<p class=MsoNormal>Spectral peaks can be integrated to find their contribution
to the overall signal.</p>

<p class=MsoNormal>&nbsp;</p>

<ul style='margin-top:0cm' type=disc>
 <li class=MsoNormal>First choose the “Select a rectangular region” option from
     the View menu. The cursor will change to show a square. (^R)</li>
</ul>

<p class=MsoNormal>&nbsp;</p>

<ul style='margin-top:0cm' type=disc>
 <li class=MsoNormal>Next draw a rectangle around the peak to integrate.</li>
</ul>

<p class=MsoNormal>&nbsp;</p>

<ul style='margin-top:0cm' type=disc>
 <li class=MsoNormal>Finally select the integrate peak option from the
     Calculate menu (^P)</li>
</ul>

<p class=MsoNormal>&nbsp;</p>

<p class=MsoNormal align=center style='text-align:center'><img width=481
height=210 src="AnalyseT1Plot_files/image027.png"></p>

<p class=MsoNormal>&nbsp;</p>

<p class=MsoNormal>The integral (in microvolts and as a percentage of total)
and location will be displayed in the status bar.</p>

<p class=MsoNormal>&nbsp;</p>

<p class=MsoNormal align=center style='text-align:center'><img width=201
height=31 src="AnalyseT1Plot_files/image028.png"></p>

<p class=MsoNormal style='text-align:justify'><span lang=EN-GB>&nbsp;</span></p>

</div>

</body>

</html>
