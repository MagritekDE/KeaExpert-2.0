<html>

<head>
<meta http-equiv=Content-Type content="text/html; charset=windows-1252">
<meta name=Generator content="Microsoft Word 14 (filtered)">
<title>acquire</title>
<style>
<!--
 /* Font Definitions */
 @font-face
	{font-family:Cambria;
	panose-1:2 4 5 3 5 4 6 3 2 4;}
@font-face
	{font-family:Tahoma;
	panose-1:2 11 6 4 3 5 4 4 2 4;}
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
	{margin:0cm;
	margin-bottom:.0001pt;
	font-size:12.0pt;
	font-family:"Times New Roman","serif";}
h1
	{mso-style-link:"Heading 1 Char";
	margin:0cm;
	margin-bottom:.0001pt;
	background:#FF6600;
	font-size:20.0pt;
	font-family:"Times New Roman","serif";}
h2
	{mso-style-link:"Heading 2 Char";
	margin-top:10.0pt;
	margin-right:0cm;
	margin-bottom:0cm;
	margin-left:0cm;
	margin-bottom:.0001pt;
	page-break-after:avoid;
	font-size:13.0pt;
	font-family:"Cambria","serif";
	color:#4F81BD;}
a:link, span.MsoHyperlink
	{color:blue;
	text-decoration:underline;}
a:visited, span.MsoHyperlinkFollowed
	{color:purple;
	text-decoration:underline;}
p.MsoAcetate, li.MsoAcetate, div.MsoAcetate
	{mso-style-link:"Balloon Text Char";
	margin:0cm;
	margin-bottom:.0001pt;
	font-size:8.0pt;
	font-family:"Tahoma","sans-serif";}
span.Heading1Char
	{mso-style-name:"Heading 1 Char";
	mso-style-link:"Heading 1";
	font-family:"Cambria","serif";
	color:#365F91;
	font-weight:bold;}
span.Heading2Char
	{mso-style-name:"Heading 2 Char";
	mso-style-link:"Heading 2";
	font-family:"Cambria","serif";
	color:#4F81BD;
	font-weight:bold;}
span.BalloonTextChar
	{mso-style-name:"Balloon Text Char";
	mso-style-link:"Balloon Text";
	font-family:"Tahoma","sans-serif";}
.MsoChpDefault
	{font-size:10.0pt;}
@page WordSection1
	{size:595.3pt 841.9pt;
	margin:72.0pt 90.0pt 72.0pt 90.0pt;}
div.WordSection1
	{page:WordSection1;}
-->
</style>

</head>

<body lang=EN-NZ link=blue vlink=purple>

<div class=WordSection1>

<h1>Backdoor procedures</h1>

<p class=MsoNormal>&nbsp;</p>

<p class=MsoNormal style='text-align:justify'><span lang=EN-GB>Occasionally you
may wish to run a series of experiments which modify some of the parameters you
would normally enter into a Kea macro. e.g. you may want to run an automatic series
of CPMG experiments on the same sample at different times, storing the acquired
data in different locations. You could write a new pulse program to do this and
define a more complex GUI to control the extra complexity, but in many cases it
would be easier to just call the CPMG code several times, modifying the file
name between calls.</span></p>

<p class=MsoNormal><span lang=EN-GB>&nbsp;</span></p>

<p class=MsoNormal style='text-align:justify'><span lang=EN-GB>The backdoor
procedure generated in each Kea macro provides a way to do this. In the Prospa
macro folder named Kea-Utilities there is a macro called MakeBackDoor. To use
this macro, start by running the experiment in the normal way through the
supplied GUI. Next run the MakeBackDoor macro and when the following window
appears;</span></p>

<p class=MsoNormal><span lang=EN-GB>&nbsp;</span></p>

<p class=MsoNormal><img width=200 height=96 id="Picture 2"
src="Backdoor%20procedures_files/image001.png"></p>

<p class=MsoNormal align=center style='text-align:center'><span lang=EN-GB
style='font-size:10.0pt;font-family:"Courier New"'>&nbsp;</span></p>

<p class=MsoNormal style='text-align:justify'><span lang=EN-GB>click on the
Select macro button and then click on the Kea macro GUI you have just used
(e.g. CPMG). A new macro will be created in a selectable folder which includes
the current parameter list for the experiment you have just run and a call to
the backdoor procedure of that experiment. e.g. the following code was
automatically generated by selecting the CPMG macro.</span></p>

<p class=MsoNormal><span lang=EN-GB>&nbsp;</span></p>

<p class=MsoNormal style='margin-left:18.0pt'><span lang=EN-GB
style='font-size:10.0pt;font-family:"Courier New";color:blue'>procedure</span><span
lang=EN-GB style='font-size:10.0pt;font-family:"Courier New";color:black'>(cpmgBD)</span></p>

<p class=MsoNormal style='margin-left:18.0pt'><span lang=EN-GB
style='font-size:10.0pt;font-family:"Courier New";color:black'>&nbsp; </span></p>

<p class=MsoNormal style='margin-left:18.0pt;text-autospace:none'><span
lang=EN-US style='font-size:10.0pt;font-family:"Courier New";color:black'>  </span></p>

<p class=MsoNormal style='text-autospace:none'><span style='font-size:10.0pt;
font-family:"Courier New";color:#AA0000'>   # Cache macros</span></p>

<p class=MsoNormal style='text-autospace:none'><span style='font-size:10.0pt;
font-family:"Courier New";color:black'>      </span><span style='font-size:
10.0pt;font-family:"Courier New";color:green'>cd</span><span style='font-size:
10.0pt;font-family:"Courier New";color:black'>(</span><span style='font-size:
10.0pt;font-family:"Courier New";color:gray'>&quot;$appdir$\\Macros\\Kea-NMR&quot;</span><span
style='font-size:10.0pt;font-family:"Courier New";color:black'>)</span></p>

<p class=MsoNormal style='text-autospace:none'><span style='font-size:10.0pt;
font-family:"Courier New";color:black'>      </span><span style='font-size:
10.0pt;font-family:"Courier New";color:green'>cachemacro</span><span
style='font-size:10.0pt;font-family:"Courier New";color:black'>(</span><span
style='font-size:10.0pt;font-family:"Courier New";color:gray'>&quot;CPMG.mac&quot;</span><span
style='font-size:10.0pt;font-family:"Courier New";color:black'>,</span><span
style='font-size:10.0pt;font-family:"Courier New";color:gray'>&quot;local&quot;</span><span
style='font-size:10.0pt;font-family:"Courier New";color:black'>)</span></p>

<p class=MsoNormal style='text-autospace:none'><span style='font-size:10.0pt;
font-family:"Courier New";color:black'>      </span><span style='font-size:
10.0pt;font-family:"Courier New";color:green'>cd</span><span style='font-size:
10.0pt;font-family:"Courier New";color:black'>(</span><span style='font-size:
10.0pt;font-family:"Courier New";color:gray'>&quot;$appdir$\\Macros\\Kea-Core&quot;</span><span
style='font-size:10.0pt;font-family:"Courier New";color:black'>)</span></p>

<p class=MsoNormal style='text-autospace:none'><span style='font-size:10.0pt;
font-family:"Courier New";color:black'>      </span><span style='font-size:
10.0pt;font-family:"Courier New";color:green'>cachemacro</span><span
style='font-size:10.0pt;font-family:"Courier New";color:black'>(</span><span
style='font-size:10.0pt;font-family:"Courier New";color:gray'>&quot;keaCtrl.mac&quot;</span><span
style='font-size:10.0pt;font-family:"Courier New";color:black'>,</span><span
style='font-size:10.0pt;font-family:"Courier New";color:gray'>&quot;local&quot;</span><span
style='font-size:10.0pt;font-family:"Courier New";color:black'>)</span></p>

<p class=MsoNormal style='text-autospace:none'><span style='font-size:10.0pt;
font-family:"Courier New";color:black'>      </span><span style='font-size:
10.0pt;font-family:"Courier New";color:green'>cachemacro</span><span
style='font-size:10.0pt;font-family:"Courier New";color:black'>(</span><span
style='font-size:10.0pt;font-family:"Courier New";color:gray'>&quot;keaRun.mac&quot;</span><span
style='font-size:10.0pt;font-family:"Courier New";color:black'>,</span><span
style='font-size:10.0pt;font-family:"Courier New";color:gray'>&quot;local&quot;</span><span
style='font-size:10.0pt;font-family:"Courier New";color:black'>)</span></p>

<p class=MsoNormal style='text-autospace:none'><span style='font-size:10.0pt;
font-family:"Courier New";color:black'>      </span><span style='font-size:
10.0pt;font-family:"Courier New";color:green'>cachemacro</span><span
style='font-size:10.0pt;font-family:"Courier New";color:black'>(</span><span
style='font-size:10.0pt;font-family:"Courier New";color:gray'>&quot;keaPlot.mac&quot;</span><span
style='font-size:10.0pt;font-family:"Courier New";color:black'>,</span><span
style='font-size:10.0pt;font-family:"Courier New";color:gray'>&quot;local&quot;</span><span
style='font-size:10.0pt;font-family:"Courier New";color:black'>)</span></p>

<p class=MsoNormal style='text-autospace:none'><span style='font-size:10.0pt;
font-family:"Courier New";color:black'>      </span><span style='font-size:
10.0pt;font-family:"Courier New";color:green'>cachemacro</span><span
style='font-size:10.0pt;font-family:"Courier New";color:black'>(</span><span
style='font-size:10.0pt;font-family:"Courier New";color:gray'>&quot;keaFiles.mac&quot;</span><span
style='font-size:10.0pt;font-family:"Courier New";color:black'>,</span><span
style='font-size:10.0pt;font-family:"Courier New";color:gray'>&quot;local&quot;</span><span
style='font-size:10.0pt;font-family:"Courier New";color:black'>)</span></p>

<p class=MsoNormal style='margin-left:18.0pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Courier New";color:green'>   cacheproc</span><span
style='font-size:10.0pt;font-family:"Courier New";color:black'>(</span><span
style='font-size:10.0pt;font-family:"Courier New";color:gray'>&quot;true&quot;</span><span
style='font-size:10.0pt;font-family:"Courier New";color:black'>)</span></p>

<p class=MsoNormal style='margin-left:18.0pt;text-autospace:none'><span
lang=EN-US style='font-size:10.0pt;font-family:"Courier New";color:black'>&nbsp;</span></p>

<p class=MsoNormal style='margin-left:18.0pt;text-autospace:none'><span
lang=EN-US style='font-size:10.0pt;font-family:"Courier New";color:#AA0000'>#
Set up gui par</span></p>

<p class=MsoNormal style='margin-left:18.0pt;text-autospace:none'><span
lang=EN-US style='font-size:10.0pt;font-family:"Courier New";color:black'>   </span></p>

<p class=MsoNormal style='margin-left:18.0pt;text-autospace:none'><span
lang=EN-US style='font-size:10.0pt;font-family:"Courier New";color:black'>  
guipar = [</span><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
color:gray'>&quot;90Amplitude = -21&quot;</span><span lang=EN-US
style='font-size:10.0pt;font-family:"Courier New";color:black'>,</span></p>

<p class=MsoNormal style='margin-left:18.0pt'><span lang=EN-US
style='font-size:10.0pt;font-family:"Courier New";color:black'>             </span><span
lang=EN-US style='font-size:10.0pt;font-family:"Courier New";color:gray'>&quot;180Amplitude
= -14&quot;</span><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
color:black'>,</span></p>

<p class=MsoNormal style='margin-left:18.0pt'><span lang=EN-GB
style='font-size:10.0pt;font-family:"Courier New";color:gray'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
...</span></p>

<p class=MsoNormal style='margin-left:18.0pt'><span lang=EN-US
style='font-size:10.0pt;font-family:"Courier New";color:black'>             </span><span
lang=EN-US style='font-size:10.0pt;font-family:"Courier New";color:gray'>&quot;x_minimum
= 1&quot;</span><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
color:black'>]</span></p>

<p class=MsoNormal style='margin-left:18.0pt'><span lang=EN-GB
style='font-size:10.0pt;font-family:"Courier New";color:black'>&nbsp;</span></p>

<p class=MsoNormal style='margin-left:18.0pt'><span lang=EN-GB
style='font-size:10.0pt;font-family:"Courier New";color:black'>&nbsp;</span></p>

<p class=MsoNormal style='margin-left:18.0pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Courier New";color:#AA0000'># Run the
macro via the backdoor</span></p>

<p class=MsoNormal style='margin-left:21.3pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Courier New";color:black'>   mac = </span><span
style='font-size:10.0pt;font-family:"Courier New";color:gray'>&quot;CPMG:backdoor&quot;</span></p>

<p class=MsoNormal style='margin-left:21.3pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Courier New";color:black'>   </span><span
style='font-size:10.0pt;font-family:"Courier New";color:teal'>mac</span><span
style='font-size:10.0pt;font-family:"Courier New";color:black'>(guipar)</span></p>

<p class=MsoNormal style='margin-left:21.3pt;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Courier New";color:black'>&nbsp;</span></p>

<p class=MsoNormal style='margin-left:21.3pt'><span style='font-size:10.0pt;
font-family:"Courier New";color:blue'>endproc</span><span style='font-size:
10.0pt;font-family:"Courier New";color:black'>()</span></p>

<p class=MsoNormal><span lang=EN-GB>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-GB>The first part of the code caches the
various macros used by the procedure to speed up processing. Without this code
you will not be able to use short repetition times. (This caching occurs
automatically when using the normal GUI macro).</span></p>

<p class=MsoNormal><span lang=EN-GB>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-GB>The next part of the code defines all the
GUI parameters required by the CPMG macro. Most of the list has been removed
for brevity. </span></p>

<p class=MsoNormal><span lang=EN-GB>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-GB>Note than the macro name has been stored in
the string mac. This is necessary since some macro names (such as T1-IR)
would be interpreted as expressions if run directly.</span></p>

<p class=MsoNormal><span lang=EN-GB>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-GB>If you now run this macro it will duplicate
the actions of the normal GUI macro just as if you had just pressed the Run
button in the CPMG macro.</span></p>

<p class=MsoNormal><span lang=EN-GB>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-GB>You can now modify the actions of this
backdoor macro to perform the desired function e.g.</span></p>

<p class=MsoNormal><span lang=EN-GB>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-GB style='font-size:10.0pt;font-family:"Courier New";
color:#AA0000'># Perform 10 identical CPMG experiments spaced 1 hour apart</span></p>

<p class=MsoNormal><span lang=EN-GB style='font-size:10.0pt;font-family:"Courier New";
color:black'>&nbsp;&nbsp; </span><span lang=EN-GB style='font-size:10.0pt;
font-family:"Courier New";color:blue'>for</span><span lang=EN-GB
style='font-size:10.0pt;font-family:"Courier New";color:black'>(t = 0 </span><span
lang=EN-GB style='font-size:10.0pt;font-family:"Courier New";color:blue'>to</span><span
lang=EN-GB style='font-size:10.0pt;font-family:"Courier New";color:black'> 9)</span></p>

<p class=MsoNormal><span lang=EN-GB style='font-size:10.0pt;font-family:"Courier New";
color:gray'>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-GB style='font-size:10.0pt;font-family:"Courier New";
color:black'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; guipar = </span><span lang=EN-GB
style='font-size:10.0pt;font-family:"Courier New";color:green'>setlistvalue</span><span
lang=EN-GB style='font-size:10.0pt;font-family:"Courier New";color:black'>(guipar,</span><span
lang=EN-GB style='font-size:10.0pt;font-family:"Courier New";color:gray'>&quot;expName&quot;</span><span
lang=EN-GB style='font-size:10.0pt;font-family:"Courier New";color:black'>,</span><span
lang=EN-GB style='font-size:10.0pt;font-family:"Courier New";color:gray'>&quot;\&quot;cpmg$t$\&quot;&quot;</span><span
lang=EN-GB style='font-size:10.0pt;font-family:"Courier New";color:black'>)</span></p>

<p class=MsoNormal><span lang=EN-GB style='font-size:10.0pt;font-family:"Courier New";
color:black'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span lang=EN-GB
style='font-size:10.0pt;font-family:"Courier New";color:teal'>mac</span><span
lang=EN-GB style='font-size:10.0pt;font-family:"Courier New";color:black'>(guipar)</span></p>

<p class=MsoNormal><span lang=EN-GB style='font-size:10.0pt;font-family:"Courier New";
color:black'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span lang=EN-GB
style='font-size:10.0pt;font-family:"Courier New";color:#780078'>pause</span><span
lang=EN-GB style='font-size:10.0pt;font-family:"Courier New";color:black'>(3600)
</span><span lang=EN-GB style='font-size:10.0pt;font-family:"Courier New";
color:#AA0000'># Wait an hour</span></p>

<p class=MsoNormal><span lang=EN-GB style='font-size:10.0pt;font-family:"Courier New";
color:black'>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-GB style='font-size:10.0pt;font-family:"Courier New";
color:black'>&nbsp;&nbsp; </span><span lang=EN-GB style='font-size:10.0pt;
font-family:"Courier New";color:blue'>next</span><span lang=EN-GB
style='font-size:10.0pt;font-family:"Courier New";color:black'>(t)</span></p>

<p class=MsoNormal><span lang=EN-GB style='font-size:10.0pt;font-family:"Courier New";
color:black'>&nbsp;</span></p>

<p class=MsoNormal style='text-align:justify'><span lang=EN-GB>In this case the
file name in the guipar list has been modified so the experimental results are
stored in a series of folders named cpmg0 cpmg1 ... cpmg9.</span></p>

<p class=MsoNormal><span lang=EN-GB>&nbsp;</span></p>

<p class=MsoNormal style='text-align:justify'><span lang=EN-GB>Even more
flexibility can be gained by storing different guipar lists in a series of
files which can then be loaded between experiments. These lists could be taken
directly from file with names like <i>list1.par list2.par </i>... found in a
folder in the Kea directory.</span></p>

<p class=MsoNormal><span lang=EN-GB>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-GB style='font-size:10.0pt;font-family:"Courier New";
color:#AA0000'># Perform 10 CPMG experiments with different sets of parameters</span></p>

<p class=MsoNormal><span lang=EN-GB style='font-size:10.0pt;font-family:"Courier New";
color:black'>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-GB style='font-size:10.0pt;font-family:"Courier New";
color:black'>&nbsp;&nbsp; </span><span lang=EN-GB style='font-size:10.0pt;
font-family:"Courier New";color:blue'>for</span><span lang=EN-GB
style='font-size:10.0pt;font-family:"Courier New";color:black'>(t = 0 </span><span
lang=EN-GB style='font-size:10.0pt;font-family:"Courier New";color:blue'>to</span><span
lang=EN-GB style='font-size:10.0pt;font-family:"Courier New";color:black'> 9)</span></p>

<p class=MsoNormal><span lang=EN-GB style='font-size:10.0pt;font-family:"Courier New";
color:black'>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-GB style='font-size:10.0pt;font-family:"Courier New";
color:black'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span lang=EN-GB
style='font-size:10.0pt;font-family:"Courier New";color:green'>cd</span><span
lang=EN-GB style='font-size:10.0pt;font-family:"Courier New";color:black'>(</span><span
lang=EN-GB style='font-size:10.0pt;font-family:"Courier New";color:gray'>&quot;$appdir$\\Macros\\Kea\\test_bd&quot;</span><span
lang=EN-GB style='font-size:10.0pt;font-family:"Courier New";color:black'>)</span></p>

<p class=MsoNormal><span lang=EN-GB style='font-size:10.0pt;font-family:"Courier New";
color:black'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; guipar = </span><span lang=EN-GB
style='font-size:10.0pt;font-family:"Courier New";color:green'>load</span><span
lang=EN-GB style='font-size:10.0pt;font-family:"Courier New";color:black'>(</span><span
lang=EN-GB style='font-size:10.0pt;font-family:"Courier New";color:gray'>&quot;list$t$.par&quot;</span><span
lang=EN-GB style='font-size:10.0pt;font-family:"Courier New";color:black'>)</span></p>

<p class=MsoNormal><span lang=EN-GB style='font-size:10.0pt;font-family:"Courier New";
color:black'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; guipar = </span><span lang=EN-GB
style='font-size:10.0pt;font-family:"Courier New";color:green'>setlistvalue</span><span
lang=EN-GB style='font-size:10.0pt;font-family:"Courier New";color:black'>(guipar,</span><span
lang=EN-GB style='font-size:10.0pt;font-family:"Courier New";color:gray'>&quot;expName&quot;</span><span
lang=EN-GB style='font-size:10.0pt;font-family:"Courier New";color:black'>,&quot;\&quot;fid$t$\&quot;&quot;)</span></p>

<p class=MsoNormal><span lang=EN-GB style='font-size:10.0pt;font-family:"Courier New";
color:black'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span lang=EN-GB
style='font-size:10.0pt;font-family:"Courier New";color:teal'>mac</span><span
lang=EN-GB style='font-size:10.0pt;font-family:"Courier New";color:black'>(guipar)</span></p>

<p class=MsoNormal><span lang=EN-GB style='font-size:10.0pt;font-family:"Courier New";
color:black'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span lang=EN-GB
style='font-size:10.0pt;font-family:"Courier New";color:green'>pause</span><span
lang=EN-GB style='font-size:10.0pt;font-family:"Courier New";color:black'>(3600)</span></p>

<p class=MsoNormal><span lang=EN-GB style='font-size:10.0pt;font-family:"Courier New";
color:black'>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-GB style='font-size:10.0pt;font-family:"Courier New";
color:black'>&nbsp;&nbsp; </span><span lang=EN-GB style='font-size:10.0pt;
font-family:"Courier New";color:blue'>next</span><span lang=EN-GB
style='font-size:10.0pt;font-family:"Courier New";color:black'>(t)</span></p>

<p class=MsoNormal><span lang=EN-GB style='font-size:10.0pt;font-family:"Courier New";
color:black'>&nbsp;</span></p>

<p class=MsoNormal style='text-align:justify'><span lang=EN-GB>A complex
example of the use of the backdoor procedure is the macro BatchProcessing in
the keaNMR menu. This runs a series of NMR experiments one after the other in a
user specified order.</span></p>

<h2><a name="_Toc317500300"></a><a name="_Toc315518722"></a><a
name="_Toc315512121"></a><a name="interleaving_pulse_seq"></a><span
style='font-size:14.0pt'>Interleaving pulse sequences using the backdoor
procedure</span></h2>

<p class=MsoNormal style='text-align:justify'><b><span lang=EN-GB>&nbsp;</span></b></p>

<p class=MsoNormal style='text-align:justify'><span lang=EN-GB>Occasionally you
may want to run one pulse sequence from within another macro which runs a
different pulse sequence. For example you could call the 1-pulse experiment after
each scan in a long CPMG experiment to adjust the B1 frequency and thereby
establish a frequency lock. To do this you need to take a snapshot of the Kea
processor code before running the second experiment and then restore it again
afterwards so that the original experiment can run correctly. Two keaRun
procedures are provided for this purpose: saveDSPState and restoreDSPState.
They also take a copy of the window variables currently in existence and
restore these as well.&nbsp; Here is some example code:</span></p>

<p class=MsoNormal style='text-align:justify'><span lang=EN-GB>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-GB style='font-size:9.0pt;font-family:"Courier New";
color:black'>&nbsp;</span><span lang=EN-US style='font-size:9.0pt;font-family:
"Courier New";color:black'>(winVariables,parameters,filterCoef,pulseProg,tables)</span><span
lang=EN-GB style='font-size:9.0pt;font-family:"Courier New";color:black'> = </span><span
lang=EN-GB style='font-size:9.0pt;font-family:"Courier New";color:teal'>keaRun:saveKeaState</span><span
lang=EN-GB style='font-size:9.0pt;font-family:"Courier New";color:black'>(guipar)</span></p>

<p class=MsoNormal><span lang=EN-GB style='font-size:9.0pt;font-family:"Courier New";
color:black'>&nbsp;&nbsp;b1Freq = </span><span lang=EN-GB style='font-size:
9.0pt;font-family:"Courier New";color:teal'>1pulseBD</span><span lang=EN-GB
style='font-size:9.0pt;font-family:"Courier New";color:black'>(b1Freq)&nbsp;&nbsp;&nbsp;
</span></p>

<p class=MsoNormal><span lang=EN-GB style='font-size:9.0pt;font-family:"Courier New";
color:teal'>&nbsp;&nbsp;keaRun:restoreKeaState</span><span lang=EN-GB
style='font-size:9.0pt;font-family:"Courier New";color:black'>(</span><span
lang=EN-US style='font-size:9.0pt;font-family:"Courier New";color:black'>winVariables,parameters,filterCoef,pulseProg,tables,guipar</span><span
lang=EN-GB style='font-size:9.0pt;font-family:"Courier New";color:black'>)</span></p>

<p class=MsoNormal style='text-align:justify'><span lang=EN-GB>&nbsp;</span></p>

<p class=MsoNormal style='text-align:justify'><span lang=EN-GB>In this case a
1-pulse backdoor has been modified to return the new frequency found after
performing a pulse and collect macro. In this example guipar is the list of GUI
parameters available which has been passed to the execpp procedure. A more
complete example can be found in the fbpimaging macro in the keaMRI menu.</span></p>

<p class=MsoNormal style='text-align:justify'><span lang=EN-GB>&nbsp;</span></p>

<p class=MsoNormal style='margin-left:92.15pt;text-indent:-92.15pt'><span
lang=EN-GB>&nbsp;&nbsp;&nbsp;</span></p>

<div style='border:none;border-top:solid windowtext 1.0pt;padding:1.0pt 0cm 0cm 0cm'>

<p class=MsoNormal style='border:none;padding:0cm'>&nbsp;</p>

</div>

<p class=MsoNormal style='text-align:justify'><i>&nbsp;Correct for Prospa
version 3.12,  1-August-2012</i></p>

<p class=MsoNormal style='text-align:justify'><span lang=EN-GB>&nbsp;</span></p>

<p class=MsoNormal style='text-align:justify'>&nbsp;</p>

</div>

</body>

</html>
